<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8">

  <link rel="canonical" href="/the-shell" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="description" content="created: 2020-11-21 08:31">

  <meta property="og:site_name" content="how i will teach tumper">

  <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=">

  <link rel="stylesheet" href="/styles.css">

  
  <meta property="og:description" content="created: 2020-11-21 08:31"/>
  

  
  <meta property="og:title" content="The shell">
  <meta property="og:type" content="article">
  

  
  <meta property="article:published_time" content="2022-02-01T17:30:39-06:00">
  <meta property="article:author" content="/">
  

  <meta property="og:url" content="/the-shell" />

  

  <title>
    
      The shell &mdash; how i will teach tumper
    
  </title>
      <script>
        var items = ['aquamarine','beige','lavender','lightgray','lightcyan','lightgoldenrodyellow','mistyrose','thistle'];
        var whic = items[Math.floor(Math.random() * items.length)];
        document.body.style.backgroundColor = whic;
      </script>
</head>

  <body>
<script>
        var items = ['aquamarine','beige','lavender','gainsboro','powderblue','lightgoldenrodyellow','mistyrose','thistle','paleturquoise','pink','lightcyan'];
        var whic = items[Math.floor(Math.random() * items.length)];
        document.body.style.backgroundColor = whic;
      </script>
    <nav><div>
    <a style="font-size: 0.8em; font-weight:bold" class="internal-link" href="/"><b>how i will teach tumper</b></a>
</div>
</nav>
    <div class="wrapper">
      <main><article>
  <div>
    <h1>The shell</h1>
    <time datetime="2022-02-01T17:19:31-06:00">
      Last updated on February 1, 2022
      
    </time>
  </div>

  <div id="notes-entry-container">
    <content>
      <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<p>created: 2020-11-21 08:31</p>

<p>the shell</p>

<p>We imagine the shell in order to protect the mind-body from distractions of the world of deception and those adherences that prevent wisdom, the world of doubt, fear, and misconception.</p>

<p>For earth, it must be light like fine very thin porcelain, yet strong and sharp like smooth obsidian, for metal, it must be tough as titanium, yet as malleable as pure gold, for air, it must be like a stiff breeze yet lofty as the brisk wind, for fluid, it must gush with ease like a brook, yet glisten like the morning dew on a rose petal.</p>

<p>Inside this shell resides virtually at first air, but thin. You could bounce a ball around inside and it would tumble at length for there is little friction. Eventually this air dissolves into nothing and soon, if one were able to put their hand through the shell it would move around and feel nothing. One captures this feeling whole heartedly and once cemented, then proceeds to realize it is not air that is inside, but that there is no inside.  It is but rather a gateway, like a window. If one were able to look through the shell, they would not see the other side of you, but rather be looking into the n-dimensional “space” where physical properties such as mass and volume cease to exist, as does our physical concept of space and time. It has no color or lack of color, so it cannot be black or white, since those labels too are confined to a misconception. In this n-dimensional “space”, there is no causality, since it represents all possible outcomes of all possible events. For practical purposes, it could best be visualized as looking out into a vast starry sky.</p>

<p>One must meditate in this fashion. First the shell, then the air inside, then the realization of it as a gateway. The length of time of this preparation is not important, but it should be neither rushed nor prolonged.</p>
</body></html>

    </content>

    <side style="font-size: 0.9em">
      <h3 style="margin-bottom: 1em">Notes mentioning this note</h3>
      
      <div style="display: grid; grid-gap: 1em; grid-template-columns: repeat(1fr);">
      
        <div class="backlink-box">
        <a class="internal-link" href="/home">Home</a><br>
        <div style="font-size: 0.9em">#catalog [[Meta thinking]] [[Outline]] [[Tsongkhapa’s Six Yogas of Naropa]] [[anti traditions]] [[bliss]] [[bootstrapping]] [[breath]] [[chakra]] [[chi sickness]] [[conflict spiders ugliness]]...</div>
        </div>
      
      </div>
      
    </side>
  </div>
</article>

<hr>

<p>Here are all the notes in this garden, along with their links, visualized as a graph.</p>

<style>
  .links line {
    stroke: #ccc;
    opacity: 0.5;
  }

  .nodes circle {
    cursor: pointer;
    fill: #8b88e6;
    transition: all 0.15s ease-out;
  }

  .text text {
    cursor: pointer;
    fill: #333;
    text-shadow: -1px -1px 0 #fafafabb, 1px -1px 0 #fafafabb, -1px 1px 0 #fafafabb, 1px 1px 0 #fafafabb;
  }

  .nodes [active],
  .text [active] {
    cursor: pointer;
    fill: black;
  }

  .inactive {
    opacity: 0.1;
    transition: all 0.15s ease-out;
  }

  #graph-wrapper {
    background: #fcfcfc;
    border-radius: 4px;
    height: auto;
  }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.16.0/d3.min.js"
  integrity="sha512-FHsFVKQ/T1KWJDGSbrUhTJyS1ph3eRrxI228ND0EGaEp6v4a/vGwPWd3Dtd/+9cI7ccofZvl/wulICEurHN1pg=="
  crossorigin="anonymous"></script>

<div id="graph-wrapper">
  <script>
    const MINIMAL_NODE_SIZE = 8;
    const MAX_NODE_SIZE = 12;
    const ACTIVE_RADIUS_FACTOR = 1.5;
    const STROKE = 1;
    const FONT_SIZE = 16;
    const TICKS = 200;
    const FONT_BASELINE = 40;
    const MAX_LABEL_LENGTH = 50;

    const graphData = {"edges":[{"source":"825062","target":"512224313740964493078928148835392547"},{"source":"825062","target":"2949839463227255404"},{"source":"256377107416644333786140961388","target":"2949839463227255404"},{"source":"825062","target":"54106474154"},{"source":"825062","target":"867031015169367661533942520452550658141134"},{"source":"957484","target":"867031015169367661533942520452550658141134"},{"source":"825062","target":"1818685915062314820184"},{"source":"136884775227247688786417","target":"1818685915062314820184"},{"source":"825062","target":"19479916"},{"source":"256377107416644333786140961388","target":"19479916"},{"source":"15775390463640423565957358719730115160","target":"19479916"},{"source":"54106474154","target":"55371889978116225964"},{"source":"1818685915062314820184","target":"55371889978116225964"},{"source":"28942228936","target":"55371889978116225964"},{"source":"825062","target":"55371889978116225964"},{"source":"231161586081190401830553016804","target":"55371889978116225964"},{"source":"825062","target":"711144773"},{"source":"2310454170389","target":"711144773"},{"source":"49438102535444153","target":"754641046"},{"source":"825062","target":"754641046"},{"source":"957484","target":"754641046"},{"source":"2310454170389","target":"754641046"},{"source":"28942228936","target":"45653434661408428"},{"source":"825062","target":"45653434661408428"},{"source":"58823992926126","target":"45653434661408428"},{"source":"8447392717038500716004245616","target":"45653434661408428"},{"source":"825062","target":"219754034375667871749335501700722860"},{"source":"825062","target":"8009305291450398825883823662353326680"},{"source":"54106474154","target":"28942228936"},{"source":"825062","target":"28942228936"},{"source":"825062","target":"49438102535444153"},{"source":"825062","target":"4191966613893428614039180693"},{"source":"256377107416644333786140961388","target":"4191966613893428614039180693"},{"source":"512224313740964493078928148835392547","target":"57326282518515435"},{"source":"825062","target":"57326282518515435"},{"source":"8447392717038500716004245616","target":"57326282518515435"},{"source":"825062","target":"2159510993089066468"},{"source":"19479916","target":"1666289346886103"},{"source":"825062","target":"1666289346886103"},{"source":"957484","target":"1666289346886103"},{"source":"231161586081190401830553016804","target":"825062"},{"source":"54106474154","target":"114520446093810147075892"},{"source":"825062","target":"114520446093810147075892"},{"source":"825062","target":"249395576288130965911570650880688"},{"source":"825062","target":"2456268914723412407"},{"source":"825062","target":"2061574597115686"},{"source":"8447392717038500716004245616","target":"2061574597115686"},{"source":"825062","target":"957484"},{"source":"2061574597115686","target":"957484"},{"source":"58823992926126","target":"957484"},{"source":"825062","target":"1633766799870"},{"source":"136884775227247688786417","target":"1633766799870"},{"source":"49438102535444153","target":"58823992926126"},{"source":"825062","target":"58823992926126"},{"source":"867031015169367661533942520452550658141134","target":"35762902"},{"source":"825062","target":"35762902"},{"source":"825062","target":"35963304"},{"source":"825062","target":"136884775227247688786417"},{"source":"825062","target":"1747192484692"},{"source":"957484","target":"1747192484692"},{"source":"825062","target":"231161586081190401830553016804"},{"source":"825062","target":"303279232050808260652297340251265"},{"source":"825062","target":"112249211648628040918"},{"source":"825062","target":"256377107416644333786140961388"},{"source":"825062","target":"15775390463640423565957358719730115160"},{"source":"4191966613893428614039180693","target":"9435218841946375067114196639723"},{"source":"825062","target":"9435218841946375067114196639723"},{"source":"825062","target":"121736950891876170675"},{"source":"825062","target":"168243810505075837928297"},{"source":"825062","target":"797250126761433963503718681918741016467232"},{"source":"54106474154","target":"2147608176791"},{"source":"825062","target":"2147608176791"},{"source":"54106474154","target":"61706416046"},{"source":"825062","target":"61706416046"},{"source":"825062","target":"4845760924988777148748"},{"source":"825062","target":"62452757908"},{"source":"231161586081190401830553016804","target":"62452757908"},{"source":"825062","target":"136665833767297133932"},{"source":"825062","target":"391616294105381088065528393626340"},{"source":"1633766799870","target":"391616294105381088065528393626340"},{"source":"825062","target":"852463431503543433854585672192032156459973"},{"source":"825062","target":"304102797921780038729756972799"},{"source":"825062","target":"2310438798662"},{"source":"825062","target":"2310454170389"},{"source":"256377107416644333786140961388","target":"2310454170389"},{"source":"825062","target":"8447392717038500716004245616"},{"source":"825062","target":"2310460426281"},{"source":"825062","target":"234650912146969343864242348"},{"source":"256377107416644333786140961388","target":"234650912146969343864242348"},{"source":"825062","target":"234727690955862206639785803"},{"source":"825062","target":"868603889187727363022687850029171174589016"},{"source":"825062","target":"89406361619379"},{"source":"825062","target":"4275148101124561897"},{"source":"256377107416644333786140961388","target":"4275148101124561897"},{"source":"2310454170389","target":"4275148101124561897"},{"source":"825062","target":"153905361800039106797"},{"source":"825062","target":"3300603681260914"}],"nodes":[{"id":"512224313740964493078928148835392547","path":"/tkenben-mastodon-as-tumper","label":"@tkenben@mastodon as tumper"},{"id":"2949839463227255404","path":"/meta-thinking","label":"Meta thinking"},{"id":"54106474154","path":"/outline","label":"Outline"},{"id":"867031015169367661533942520452550658141134","path":"/tsongkhapa-s-six-yogas-of-naropa","label":"Tsongkhapa's six yogas of naropa"},{"id":"9283946272959743046009118388","path":"/weird-dreams-not-book","label":"Weird dreams   not book"},{"id":"1818685915062314820184","path":"/anti-traditions","label":"Anti traditions"},{"id":"19479916","path":"/bliss","label":"Bliss"},{"id":"55371889978116225964","path":"/bootstrapping","label":"Bootstrapping"},{"id":"711144773","path":"/breath","label":"Breath"},{"id":"754641046","path":"/chakra","label":"Chakra"},{"id":"45653434661408428","path":"/chi-sickness","label":"Chi sickness"},{"id":"219754034375667871749335501700722860","path":"/conflict-spiders-ugliness","label":"Conflict spiders ugliness"},{"id":"8009305291450398825883823662353326680","path":"/cube-screw-generalizations","label":"Cube screw generalizations"},{"id":"28942228936","path":"/dangers","label":"Dangers"},{"id":"49438102535444153","path":"/discernment","label":"Discernment"},{"id":"4191966613893428614039180693","path":"/empty-shell-extended","label":"Empty shell extended"},{"id":"57326282518515435","path":"/foggy-mirror","label":"Foggy mirror"},{"id":"2159510993089066468","path":"/general-notes","label":"General notes"},{"id":"1666289346886103","path":"/generation","label":"Generation"},{"id":"825062","path":"/home","label":"Home"},{"id":"114520446093810147075892","path":"/inconsistencies","label":"Inconsistencies"},{"id":"249395576288130965911570650880688","path":"/innate-bliss-no-mind-link","label":"Innate bliss no mind link"},{"id":"2456268914723412407","path":"/intent-reason","label":"Intent_reason"},{"id":"2061574597115686","path":"/karmamudra","label":"Karmamudra"},{"id":"957484","path":"/kiss","label":"Kiss"},{"id":"1633766799870","path":"/kuji-kiri","label":"Kuji kiri"},{"id":"58823992926126","path":"/kundalini","label":"Kundalini"},{"id":"35762902","path":"/laity","label":"Laity"},{"id":"35963304","path":"/let-go","label":"Let go"},{"id":"136884775227247688786417","path":"/magick-and-occult","label":"Magick and occult"},{"id":"1747192484692","path":"/mandalas","label":"Mandalas"},{"id":"231161586081190401830553016804","path":"/meta-about-these-notes","label":"Meta about these notes"},{"id":"303279232050808260652297340251265","path":"/more-notes-title-concept","label":"More notes title concept"},{"id":"112249211648628040918","path":"/note-on-empathy","label":"Note on empathy"},{"id":"256377107416644333786140961388","path":"/outline-meta-thinking","label":"Outline meta thinking"},{"id":"15775390463640423565957358719730115160","path":"/paleo-libido-illustrations","label":"Paleo libido illustrations"},{"id":"9435218841946375067114196639723","path":"/perceptions-and-flavor","label":"Perceptions and flavor"},{"id":"121736950891876170675","path":"/power-in-prayer","label":"Power in prayer"},{"id":"168243810505075837928297","path":"/real-life-consort","label":"Real life consort"},{"id":"797250126761433963503718681918741016467232","path":"/recommended-sequence-of-events","label":"Recommended sequence of events"},{"id":"2147608176791","path":"/religion","label":"Religion"},{"id":"61706416046","path":"/science","label":"Science"},{"id":"4845760924988777148748","path":"/sentient-beings","label":"Sentient beings"},{"id":"62452757908","path":"/sources","label":"Sources"},{"id":"136665833767297133932","path":"/submit-to-bliss","label":"Submit to bliss"},{"id":"391616294105381088065528393626340","path":"/tantric-buddhist-magick","label":"Tantric buddhist magick"},{"id":"852463431503543433854585672192032156459973","path":"/tantric-pride-wonderful-secret","label":"Tantric pride wonderful secret"},{"id":"304102797921780038729756972799","path":"/the-answer-is-no-sort-of","label":"The answer is no sort of"},{"id":"2310438798662","path":"/the-flume","label":"The flume"},{"id":"2310454170389","path":"/the-orbit","label":"The orbit"},{"id":"8447392717038500716004245616","path":"/the-problem-with-kink","label":"The problem with kink"},{"id":"2310460426281","path":"/the-shell","label":"The shell"},{"id":"234650912146969343864242348","path":"/the-wave-good-stress","label":"The wave good stress"},{"id":"234727690955862206639785803","path":"/three-gs-other-stuff","label":"Three gs other stuff"},{"id":"868603889187727363022687850029171174589016","path":"/tumper-and-dinkle-expectations","label":"Tumper and dinkle expectations"},{"id":"89406361619379","path":"/vow-prayer","label":"Vow prayer"},{"id":"4275148101124561897","path":"/what-is-no-mind","label":"What is no mind"},{"id":"153905361800039106797","path":"/what-this-is-not","label":"What this is not"},{"id":"3300603681260914","path":"/why-secrecy","label":"Why secrecy"}]}
    let nodesData = graphData.nodes;
    let linksData = graphData.edges;

    const nodeSize = {};

    const updateNodeSize = () => {
      nodesData.forEach((el) => {
        let weight =
          3 *
          Math.sqrt(
            linksData.filter((l) => l.source === el.id || l.target === el.id)
              .length + 1
          );
        if (weight < MINIMAL_NODE_SIZE) {
          weight = MINIMAL_NODE_SIZE;
        } else if (weight > MAX_NODE_SIZE) {
          weight = MAX_NODE_SIZE;
        }
        nodeSize[el.id] = weight;
      });
    };

    const onClick = (d) => {
      window.location = d.path
    };

    const onMouseover = function (d) {
      const relatedNodesSet = new Set();
      linksData
        .filter((n) => n.target.id == d.id || n.source.id == d.id)
        .forEach((n) => {
          relatedNodesSet.add(n.target.id);
          relatedNodesSet.add(n.source.id);
        });

      node.attr("class", (node_d) => {
        if (node_d.id !== d.id && !relatedNodesSet.has(node_d.id)) {
          return "inactive";
        }
        return "";
      });

      link.attr("class", (link_d) => {
        if (link_d.source.id !== d.id && link_d.target.id !== d.id) {
          return "inactive";
        }
        return "";
      });

      link.attr("stroke-width", (link_d) => {
        if (link_d.source.id === d.id || link_d.target.id === d.id) {
          return STROKE * 4;
        }
        return STROKE;
      });
      text.attr("class", (text_d) => {
        if (text_d.id !== d.id && !relatedNodesSet.has(text_d.id)) {
          return "inactive";
        }
        return "";
      });
    };

    const onMouseout = function (d) {
      node.attr("class", "");
      link.attr("class", "");
      text.attr("class", "");
      link.attr("stroke-width", STROKE);
    };

    const sameNodes = (previous, next) => {
      if (next.length !== previous.length) {
        return false;
      }

      const map = new Map();
      for (const node of previous) {
        map.set(node.id, node.label);
      }

      for (const node of next) {
        const found = map.get(node.id);
        if (!found || found !== node.title) {
          return false;
        }
      }

      return true;
    };

    const sameEdges = (previous, next) => {
      if (next.length !== previous.length) {
        return false;
      }

      const set = new Set();
      for (const edge of previous) {
        set.add(`${edge.source.id}-${edge.target.id}`);
      }

      for (const edge of next) {
        if (!set.has(`${edge.source}-${edge.target}`)) {
          return false;
        }
      }

      return true;
    };

    const graphWrapper = document.getElementById('graph-wrapper')
    const element = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    element.setAttribute("width", graphWrapper.getBoundingClientRect().width);
    element.setAttribute("height", window.innerHeight * 0.8);
    graphWrapper.appendChild(element);

    const reportWindowSize = () => {
      element.setAttribute("width", window.innerWidth);
      element.setAttribute("height", window.innerHeight);
    };

    window.onresize = reportWindowSize;

    const svg = d3.select("svg");
    const width = Number(svg.attr("width"));
    const height = Number(svg.attr("height"));
    let zoomLevel = 1;

    const simulation = d3
      .forceSimulation(nodesData)
      .force("forceX", d3.forceX().x(width / 2))
      .force("forceY", d3.forceY().y(height / 2))
      .force("charge", d3.forceManyBody())
      .force(
        "link",
        d3
          .forceLink(linksData)
          .id((d) => d.id)
          .distance(70)
      )
      .force("center", d3.forceCenter(width / 2, height / 2))
      .force("collision", d3.forceCollide().radius(80))
      .stop();

    const g = svg.append("g");
    let link = g.append("g").attr("class", "links").selectAll(".link");
    let node = g.append("g").attr("class", "nodes").selectAll(".node");
    let text = g.append("g").attr("class", "text").selectAll(".text");

    const resize = () => {
      if (d3.event) {
        const scale = d3.event.transform;
        zoomLevel = scale.k;
        g.attr("transform", scale);
      }

      const zoomOrKeep = (value) => (zoomLevel >= 1 ? value / zoomLevel : value);

      const font = Math.max(Math.round(zoomOrKeep(FONT_SIZE)), 1);

      text.attr("font-size", (d) => font);
      text.attr("y", (d) => d.y - zoomOrKeep(FONT_BASELINE) + 8);
      link.attr("stroke-width", zoomOrKeep(STROKE));
      node.attr("r", (d) => {
        return zoomOrKeep(nodeSize[d.id]);
      });
      svg
        .selectAll("circle")
        .filter((_d, i, nodes) => d3.select(nodes[i]).attr("active"))
        .attr("r", (d) => zoomOrKeep(ACTIVE_RADIUS_FACTOR * nodeSize[d.id]));
    };

    const ticked = () => {
      node.attr("cx", (d) => d.x).attr("cy", (d) => d.y);
      text
        .attr("x", (d) => d.x)
        .attr("y", (d) => d.y - (FONT_BASELINE - nodeSize[d.id]) / zoomLevel);
      link
        .attr("x1", (d) => d.source.x)
        .attr("y1", (d) => d.source.y)
        .attr("x2", (d) => d.target.x)
        .attr("y2", (d) => d.target.y);
    };

    const restart = () => {
      updateNodeSize();
      node = node.data(nodesData, (d) => d.id);
      node.exit().remove();
      node = node
        .enter()
        .append("circle")
        .attr("r", (d) => {
          return nodeSize[d.id];
        })
        .on("click", onClick)
        .on("mouseover", onMouseover)
        .on("mouseout", onMouseout)
        .merge(node);

      link = link.data(linksData, (d) => `${d.source.id}-${d.target.id}`);
      link.exit().remove();
      link = link.enter().append("line").attr("stroke-width", STROKE).merge(link);

      text = text.data(nodesData, (d) => d.label);
      text.exit().remove();
      text = text
        .enter()
        .append("text")
        .text((d) => shorten(d.label.replace(/_*/g, ""), MAX_LABEL_LENGTH))
        .attr("font-size", `${FONT_SIZE}px`)
        .attr("text-anchor", "middle")
        .attr("alignment-baseline", "central")
        .on("click", onClick)
        .on("mouseover", onMouseover)
        .on("mouseout", onMouseout)
        .merge(text);

      node.attr("active", (d) => isCurrentPath(d.path) ? true : null);
      text.attr("active", (d) => isCurrentPath(d.path) ? true : null);

      simulation.nodes(nodesData);
      simulation.force("link").links(linksData);
      simulation.alpha(1).restart();
      simulation.stop();

      for (let i = 0; i < TICKS; i++) {
        simulation.tick();
      }

      ticked();
    };

    const zoomHandler = d3.zoom().scaleExtent([0.2, 3]).on("zoom", resize);

    zoomHandler(svg);
    restart();

    function isCurrentPath(notePath) {
      return window.location.pathname.includes(notePath)
    }

    function shorten(str, maxLen, separator = ' ') {
      if (str.length <= maxLen) return str;
      return str.substr(0, str.lastIndexOf(separator, maxLen)) + '...';
    }
  </script>
</div>

</main>
      <footer>This is the footer. Include anything you'd like here, like a link to an <a class="internal-link" href="/about">About</a> page.
</footer>
    </div>

    <!-- That file is not particularly elegant. This will need a refactor at some point. -->
<style>
  content a.internal-link {
    border-color: #8b88e6;
    background-color: #efefff;
  }

  #tooltip-wrapper {
    background: white;
    padding: 1em;
    border: 1px solid #ddd;
    border-radius: 4px;
    overflow: hidden;
    position: absolute;
    width: 400px;
    height: 250px;
    font-size: 0.8em;
    box-shadow: 0 5px 10px rgba(0,0,0,0.1);
    opacity: 0;
    transition: opacity 100ms;
  }

  #tooltip-wrapper:after {
		content: "";
		position: absolute;
		z-index: 1;
		bottom: 0;
		left: 0;
		pointer-events: none;
		background-image: linear-gradient(to bottom, rgba(255,255,255, 0), rgba(255,255,255, 1) 90%);
		width: 100%;
		height: 75px;
  }
</style>

<div style="opacity: 0; display: none;" id='tooltip-wrapper'>
  <div id='tooltip-content'>
  </div>
</div>

<iframe style="display: none; height: 0; width: 0;" id='link-preview-iframe' src="">
</iframe>

<script>
  var opacityTimeout;
  var contentTimeout;
  var transitionDurationMs = 100;

  var iframe = document.getElementById('link-preview-iframe')
  var tooltipWrapper = document.getElementById('tooltip-wrapper')
  var tooltipContent = document.getElementById('tooltip-content')

  function hideTooltip() {
    opacityTimeout = setTimeout(function() {
      tooltipWrapper.style.opacity = 0;
      contentTimeout = setTimeout(function() {
        tooltipContent.innerHTML = '';
        tooltipWrapper.style.display = 'none';
      }, transitionDurationMs + 1);
    }, transitionDurationMs)
  }

  function showTooltip(event) {
    var elem = event.target;
    var elem_props = elem.getClientRects()[elem.getClientRects().length - 1];
    var top = window.pageYOffset || document.documentElement.scrollTop

    if (event.target.host === window.location.host) {
      iframe.src = event.target.href
      iframe.onload = function() {
        tooltipContentHtml = ''
        tooltipContentHtml += '<div style="font-weight: bold;">' + iframe.contentWindow.document.querySelector('h1').innerHTML + '</div>'
        tooltipContentHtml += iframe.contentWindow.document.querySelector('content').innerHTML

        tooltipContent.innerHTML = tooltipContentHtml

        tooltipWrapper.style.display = 'block';
        setTimeout(function() {
          tooltipWrapper.style.opacity = 1;
        }, 1)
      }

      tooltipWrapper.style.left = elem_props.left - (tooltipWrapper.offsetWidth / 2) + (elem_props.width / 2) + "px";
      if ((window.innerHeight - elem_props.top) < (tooltipWrapper.offsetHeight)) {
          tooltipWrapper.style.top = elem_props.top + top - tooltipWrapper.offsetHeight - 10 + "px";
      } else if ((window.innerHeight - elem_props.top) > (tooltipWrapper.offsetHeight)) {
          tooltipWrapper.style.top = elem_props.top + top + 35 + "px";
      }

      if ((elem_props.left + (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
          tooltipWrapper.style.left = "10px";
      } else if ((document.body.clientWidth - elem_props.left - (elem_props.width / 2)) < (tooltipWrapper.offsetWidth / 2)) {
          tooltipWrapper.style.left = document.body.clientWidth - tooltipWrapper.offsetWidth - 20 + "px";
      }
    }
  }

  function setupListeners(linkElement) {
    linkElement.addEventListener('mouseleave', function(_event) {
      hideTooltip();
    });

    tooltipWrapper.addEventListener('mouseleave', function(_event) {
      hideTooltip();
    });

    linkElement.addEventListener('touchend', function(_event) {
      hideTooltip();
    });

    tooltipWrapper.addEventListener('touchend', function(_event) {
      hideTooltip();
    });

    linkElement.addEventListener('mouseenter', function(event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
      showTooltip(event);
    });

    tooltipWrapper.addEventListener('mouseenter', function(event) {
      clearTimeout(opacityTimeout);
      clearTimeout(contentTimeout);
    });
  }

  document.querySelectorAll('content a').forEach(setupListeners);
</script>

  </body>
</html>
